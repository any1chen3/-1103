# 军工资产管理系统后端功能详细说明

## 一、三个表通用功能

### 1. 增加功能（Add）

**实现功能**：

- 单行新增：每次请求只能新增一条完整记录
- 支持所有字段同时录入

**操作前校验**：

- **ID校验**：32位数字字母组合格式、在表中唯一不重复
- **核心字段非空**：上报单位、分类编码、资产分类、资产名称、实有数量、计量单位、盘点单位
- **分类匹配校验**：分类编码与资产分类必须匹配（通过CategoryMapUtils工具类）
- **数据格式校验**：
  - 实有数量：必须为正整数
  - 投入使用日期：不能早于当前日期50年
  - 金额字段：支持小数，保留2位小数

### 2. 删除功能（Delete）

**实现功能**：

- **物理删除**：直接从数据库表中永久移除记录
- **按行删除**：基于主键ID删除单条完整记录
- **不支持**：批量删除、按条件删除、按列删除

**操作前校验**：

- **ID存在性**：确保要删除的ID在数据库中存在
- **ID格式**：32位数字字母组合格式验证

### 3. 修改功能（Update）

**实现功能**：

- 单行修改：基于ID更新整条记录
- 支持修改所有字段
- 自动保留原始创建时间

**操作前校验**：

- **ID存在性**：确保要修改的记录存在
- **增量校验**：仅对修改的字段进行校验
- **分类匹配**：如修改分类相关字段则校验匹配性
- **特有规则**：如修改数量字段则校验数量关系

### 4. 查询功能（Query）

**实现功能**：

- **单条查询**：按ID查询完整记录详情
- **组合查询**：按上报单位和资产分类进行多条件筛选
- **排序**：按创建时间倒序排列，最新数据在前

**操作前校验**：

- **单条查询**：ID格式和存在性
- **组合查询**：无强制校验，空参数返回全部数据

## 二、三个表各自特有功能

### 1. 软件资产表特有功能

**特有字段约束**：

- `acquisition_method`（取得方式）：必填，无固定选项
- `deployment_scope`（部署范围）：必填，有固定选项（如"军以下"/"军级"等）
- `service_status`（服务状态）：必填，固定为"在用"或"闲置"

**特有校验规则**：

- 服务状态合法性：只能是"在用"或"闲置"
- 部署范围：必须在预设选项范围内

**特有业务逻辑**：

- 版本号字段：非空约束（软件特有）

### 2. 网信资产表特有功能

**特有字段约束**：

- `asset_content`（资产内容）：必填，详细描述资产
- `used_quantity`（已用数量）：必填，正整数

**特有校验规则**：

- **数量关系约束**：已用数量 ≤ 实有数量
- 已用数量必须为正整数

**特有查询功能**：

- **数量范围查询**：`/api/asset/cyber/quantity?min=10&max=50`
- **用途**：统计资源利用率，分析资产使用情况

### 3. 数据内容资产表特有功能

**特有字段约束**：

- `development_tool`（开发工具）：必填，如"Oracle"/"MySQL"等
- `data_type`（数据类型）：选填，如"结构化"
- `update_cycle`（更新周期）：选填，如"每月"/"每年"
- `update_method`（更新方式）：选填，如"在线填报"

**特有校验规则**：

- 开发工具非空约束

**特有查询功能**：

- **开发工具筛选**：`/api/asset/data/tool?developmentTool=MySQL`
- **用途**：统计不同开发工具的使用频率

## 三、导入功能详细说明

### 通用导入流程

1. **文件校验**：非空检查、上传文件大小(<=100MB)、格式校验（.xlsx或.xls）
2. **数据准备**：获取数据库中已存在ID用于去重校验
3. **解析校验**：使用EasyExcel监听器逐行解析和校验
4. **数据分离**：分离合法数据与错误数据
5. **批量入库**：对合法数据进行批量插入
6. **结果返回**：返回成功数量和详细错误列表

### 导入校验规则

**通用校验（三表共用）**：

- ID格式：32位数字字母组合
- 核心字段非空校验
- 分类编码与资产分类匹配
- 实有数量为正整数
- ID重复时对比资产名称

**软件资产特有校验**：

- 服务状态只能是"在用"或"闲置"
- 投入使用日期有效性

**网信资产特有校验**：

- 资产内容非空
- 已用数量≤实有数量
- 已用数量正整数

**数据资产特有校验**：

- 开发工具非空
- 数据类型、更新周期等字段校验

## 四、其他系统功能

### 1. 系统首页与接口文档

**前端接口**：`GET /api/asset/`

**功能内容**：

- 系统概述和功能介绍
- 完整的接口文档说明
- 所有可用接口的详细说明
- 请求格式和使用示例
- 技术栈介绍

**返回内容**：

```text
包含：
- 系统欢迎信息
- Excel导入接口说明（路径、格式、注意事项）
- CRUD接口说明（查询、新增、修改、删除）
- 使用说明（日期格式、金额格式等）
- 技术栈信息
```

### 2. 统一响应格式系统

#### CRUD操作响应格式（ResultVO）

**数据结构**：

```json
{
  "code": 200,
  "message": "操作成功描述",
  "data": {业务数据}
}
```

**具体实现**：

- **成功响应（带数据）**：

  ```java
  ResultVO.success(asset, "查询软件资产详情成功")
  // 返回：{code:200, message:"查询软件资产详情成功", data:{...}}
  ```

- **成功响应（无数据）**：

  ```java
  ResultVO.success("新增软件资产成功，ID：xxx")
  // 返回：{code:200, message:"新增软件资产成功，ID：xxx", data:null}
  ```

- **失败响应**：

  ```java
  ResultVO.fail("新增失败：ID已存在")
  // 返回：{code:500, message:"新增失败：ID已存在", data:null}
  ```

#### 导入操作响应格式（ImportResult）

**数据结构**：

```json
{
  "success": true,
  "message": "导入成功",
  "validCount": 10,
  "errorList": [
    {
      "excelRowNum": 5,
      "errorFields": "id,assetName",
      "errorMsg": "第5行：ID格式错误；资产名称为空"
    }
  ]
}
```

**错误详情格式**：

- `excelRowNum`：Excel中的行号（从1开始）
- `errorFields`：出错的字段名，多个用逗号分隔
- `errorMsg`：具体的错误原因描述

### 3. 前端接口完整列表

#### Excel导入接口

**软件资产导入**：

- **路径**：`POST /api/asset/import/software`
- **Content-Type**：`multipart/form-data`
- **参数**：`file`（Excel文件）
- **返回**：`ImportResult`格式

**网信资产导入**：

- **路径**：`POST /api/asset/import/cyber`
- 其他同上

**数据资产导入**：

- **路径**：`POST /api/asset/import/data-content`
- 其他同上

#### 查询接口

**单条查询**：

- 软件：`GET /api/asset/software/{id}`
- 网信：`GET /api/asset/cyber/{id}`
- 数据：`GET /api/asset/data/{id}`

**组合查询**：

- 软件：`GET /api/asset/software/list?reportUnit=xxx&assetCategory=xxx`
- 网信：`GET /api/asset/cyber/list?reportUnit=xxx&assetCategory=xxx`
- 数据：`GET /api/asset/data/list?reportUnit=xxx&assetCategory=xxx`

**特有查询**：

- 网信数量范围：`GET /api/asset/cyber/quantity?min=10&max=50`
- 数据开发工具：`GET /api/asset/data/tool?developmentTool=MySQL`

#### 新增接口

- 软件：`POST /api/asset/software`
- 网信：`POST /api/asset/cyber`
- 数据：`POST /api/asset/data`
- **Content-Type**：`application/json`
- **Body**：对应资产的JSON对象

#### 修改接口

- 软件：`PUT /api/asset/software`
- 网信：`PUT /api/asset/cyber`
- 数据：`PUT /api/asset/data`
- **Content-Type**：`application/json`
- **Body**：完整的资产JSON对象（必须包含ID）

#### 删除接口

- 软件：`DELETE /api/asset/software/{id}`
- 网信：`DELETE /api/asset/cyber/{id}`
- 数据：`DELETE /api/asset/data/{id}`

### 4. 事务管理功能 （对于要导入到数据库的数据进行）

**实现功能**：

- **批量导入事务**：确保Excel导入要么全部成功，要么全部失败
- **单条操作事务**：关键业务操作在事务中执行
- **异常回滚**：操作失败时自动回滚数据库变更

**技术实现**：

```java
@Transactional(rollbackFor = Exception.class)
public void add(SoftwareAsset asset) {
    // 业务逻辑和数据库操作
    // 任一步骤失败都会回滚整个操作
}
```

### 5. 数据校验体系

**分类映射工具**：

- 提供三表分类编码与资产分类的标准对应关系
- 确保数据录入的分类一致性
- 便于后续分类标准的统一调整

**业务规则引擎**：

- 各表特有约束在Service层统一处理
- 校验失败返回明确的错误信息
- 支持增量校验（修改时只校验变更字段）

### 6. 日志记录系统

**记录内容**：

- 操作开始和结束日志
- 关键业务步骤执行情况
- 错误和异常详细信息
- 导入统计信息（总记录数、成功数、错误数）

**日志格式**：

```
INFO - 开始新增软件资产，ID：xxx
INFO - 新增软件资产成功，ID：xxx
WARN - 导入错误详情：行5：id,assetName（第5行：ID格式错误；资产名称为空）
```

## 五、功能限制说明

### 不支持的功能

1. **批量操作**：不支持批量删除、批量修改
2. **条件删除**：不能基于条件删除多条记录
3. **列级操作**：不能单独修改或删除特定字段
4. **备份恢复**：备份表已创建但无实际功能
5. **数据导出**：只有导入功能，无导出功能
6. **逻辑删除**：配置存在但未实际使用

### 操作粒度限制

- **所有CRUD操作**：都是单行级别操作
- **删除操作**：只能基于ID删除单条记录
- **修改操作**：必须提供完整记录进行更新
- **查询操作**：支持单条查询和条件组合查询

所有功能描述均基于实际代码实现，确保准确反映系统当前状态。系统在数据校验、事务管理、错误处理等方面做了充分设计，为后续功能扩展提供了良好基础。
